```{r setup, echo = FALSE, include = FALSE}
library("papaja")
library("knitr") # for knitting things
library("tidyverse") # for all things tidyverse
library("car")
library("lme4")
library("patchwork")
library("effsize")
#library("Hmisc")
library("dplyr")


# these options here change the formatting of how comments are rendered
opts_chunk$set(
  comment = "",
  results = "hold",
  fig.show = "hold")

# set the default ggplot theme 
theme_set(theme_classic())

r_refs("r-references.bib")
r_refs("references/packages.bib")

```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r read in data}
df <- read.csv("../../data/data_USCNVN_ENZHVI.csv")
triads_omit_freq <- read.csv("../../data/triads_omit.csv") %>%
  pull(x)
```

# Comparing between 2 models for US repsonding
```{r US responding predicted by each corpus model raw co-occurrences, warning=FALSE}
# English 
fit.EN_US = glmer(responses_theme ~ theme_freq_prop_E + (1 | subject) + (1 | triad), 
          data = df %>% filter(country == "US", 
                               !(near(theme_frequency_E, .Machine$double.eps) & 
                                  near(tax_frequency_E, .Machine$double.eps))), 
          family="binomial")
summary(fit.EN_US)
fit.EN_US.anova = Anova(fit.EN_US, type = 3)

fit.EN_US.anova

fit.EN_US_cos = glmer(responses_theme ~ theme_cosine_prop_E + (1 | subject) + (1 | triad), 
          data = df %>% filter(country == "US", 
                               !(near(theme_frequency_E, .Machine$double.eps) & 
                                  near(tax_frequency_E, .Machine$double.eps))), 
          
          family="binomial")
summary(fit.EN_US_cos)
fit.EN_US_cos.anova = Anova(fit.EN_US_cos, type = 3)
fit.EN_US_cos.anova

fit.EN_US_compare_freq_cos = anova(fit.EN_US, fit.EN_US_cos, type = 3)
fit.EN_US_compare_freq_cos

```


# Comparing between 2 models for VN responding
```{r VN responding predicted by each corpus model raw co-occurrences, warning=FALSE}
# Vietnamese 
fit.VI_VN = glmer(responses_theme ~ theme_freq_prop_V + (1 | subject) + (1 | triad), 
          data = df %>% filter(country == "Vietnam", 
                               !(near(theme_frequency_V, .Machine$double.eps) & 
                                  near(tax_frequency_V, .Machine$double.eps))), 
          family="binomial")
summary(fit.VI_VN)
fit.VI_VN.anova = Anova(fit.EN_US, type = 3)

fit.VI_VN.anova

fit.VI_VN_cos = glmer(responses_theme ~ theme_cosine_prop_V + (1 | subject) + (1 | triad), 
          data = df %>% filter(country == "Vietnam", 
                               !(near(theme_frequency_V, .Machine$double.eps) & 
                                  near(tax_frequency_V, .Machine$double.eps))),  
          
          family="binomial")
summary(fit.VI_VN_cos)
fit.VI_VN_cos.anova = Anova(fit.VI_VN_cos, type = 3)
fit.VI_VN_cos.anova

fit.VI_VN_compare_freq_cos = anova(fit.VI_VN, fit.VI_VN_cos, type = 3)
fit.VI_VN_compare_freq_cos

```

```{r US responding predicted by each corpus model raw co-occurrences, warning=FALSE}
# Mandarin 
fit.ZH_CN = glmer(responses_theme ~ theme_freq_prop_M + (1 | subject) + (1 | triad), 
          data = df %>% filter(country == "China", 
                               !(near(theme_frequency_M, .Machine$double.eps) & 
                                  near(tax_frequency_M, .Machine$double.eps))), 
          family="binomial")
summary(fit.ZH_CN)
fit.ZH_CN.anova = Anova(fit.ZH_CN, type = 3)

fit.ZH_CN.anova

fit.ZH_CN_cos = glmer(responses_theme ~ theme_cosine_prop_M + (1 | subject) + (1 | triad), 
          data = df %>% filter(country == "China", 
                               !(near(theme_frequency_M, .Machine$double.eps) & 
                                  near(tax_frequency_M, .Machine$double.eps))),  
          
          family="binomial")
summary(fit.ZH_CN_cos)
fit.ZH_CN_cos.anova = Anova(fit.ZH_CN_cos, type = 3)
fit.ZH_CN_cos.anova

fit.ZH_CN_compare_freq_cos = anova(fit.ZH_CN, fit.ZH_CN_cos, type = 3)
fit.ZH_CN_compare_freq_cos

```

# Does adding country help with the model (compared to with corresponding lexcial co-occurrence)? 
```{r}
df <- df %>%
  mutate(theme_freq_prop_corr_lang = case_when(
    country == "US" ~ theme_freq_prop_E,
    country == "China" ~ theme_freq_prop_M, 
    country == "Vietnam" ~ theme_freq_prop_V)) %>%
  mutate(theme_frequency_corr_lang = case_when(
    country == "US" ~ theme_frequency_E,
    country == "China" ~ theme_frequency_M, 
    country == "Vietnam" ~ theme_frequency_V)) %>%
  mutate(tax_frequency_corr_lang = case_when(
    country == "US" ~ tax_frequency_E,
    country == "China" ~ tax_frequency_M, 
    country == "Vietnam" ~ tax_frequency_V))

fit.language = glmer(responses_theme ~ theme_freq_prop_corr_lang + (1 | subject) + (1 | triad), 
          data = df %>% filter(!(near(theme_frequency_corr_lang, .Machine$double.eps) & 
                                  near(tax_frequency_corr_lang, .Machine$double.eps))),  
          
          family="binomial")
summary(fit.language)
fit.language.anova = Anova(fit.language, type = 3)
fit.language.anova

fit.country_language = glmer(responses_theme ~ theme_freq_prop_corr_lang * country + (1 | subject) + (1 | triad), 
          data = df %>% filter(!(near(theme_frequency_corr_lang, .Machine$double.eps) & 
                                  near(tax_frequency_corr_lang, .Machine$double.eps))),  
          
          family="binomial")
summary(fit.country_language)

fit.country_language.anova = Anova(fit.country_language, type = 3)
fit.country_language.anova

fit.country_language_compare = anova(fit.language, fit.country_language, type = 3)
fit.country_language_compare
```

Adding country improves the model. Only country and interaction between country and corresponding corpus's lexical co-occurrence were significant predictors. Corresponding corpus's lexical co-occurrence is no longer a significant predictor. 

